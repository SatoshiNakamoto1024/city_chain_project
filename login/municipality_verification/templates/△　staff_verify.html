<!-- municipality_verification/templates/staff_verify.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ユーザー承認</title>
<style>
 body{font-family:Arial,Helvetica,sans-serif;background:#f7f7f7;padding:20px}
 table{width:100%;border-collapse:collapse;background:#fff;margin-top:20px}
 th,td{border:1px solid #ccc;padding:10px;text-align:left}
 th{background:#eee}
 button{padding:5px 10px;margin:0 4px;border:none;color:#fff;cursor:pointer}
 .approve{background:#28a745}.reject{background:#dc3545}
</style>
</head>
<body>
<h2>承認待ちユーザー一覧</h2>
<table id="tbl"><thead><tr><th>UUID</th><th>操作</th></tr></thead><tbody></tbody></table>

<script>
const jwt = localStorage.getItem("staff_jwt");
if(!jwt){alert("未ログイン");location.href="/staff/login"}

async function fetchPending(){
 const r = await fetch("/staff/verify",{headers:{Authorization:`Bearer ${jwt}`}});
 return r.json();
}
function row(u){
 return `<tr><td>${u.uuid}</td>
 <td>
  <button class="approve" onclick="act('${u.uuid}','approve')">承認</button>
  <button class="reject"  onclick="act('${u.uuid}','reject')">却下</button>
 </td></tr>`;
}
async function render(){
 const list = await fetchPending();
 q("#tbl tbody").innerHTML = (list.length > 0)
   ? list.map(row).join("")
   : "<tr><td colspan=2>0件</td></tr>";
}
async function act(uuid,action){
 if(action==="approve" && !confirm("本当に承認しますか？")) return;
 const res = await fetch("/staff/verify",{
   method:"POST",
   headers: {
     Authorization:`Bearer ${jwt}`,
     "Content-Type":"application/json"
   },
   body: JSON.stringify({uuid, action})
 });
 const j = await res.json();
 if(j.success){
   alert("完了");
   render();
 } else {
   alert(j.error || "エラーが発生しました");
 }
}
const q=s=>document.querySelector(s);
render();
</script>
</body>
</html>
