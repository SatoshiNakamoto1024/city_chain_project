
âœ… ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’NTRUã§ç™ºè¡Œã—ã¦ã„ã‚‹ã€éƒ¨åˆ†ã¨ã¯ï¼Ÿ
ä¸»ãªãƒ•ã‚¡ã‚¤ãƒ«ã¨é–¢æ•°

ãƒ•ã‚¡ã‚¤ãƒ«	é–¢æ•°	å†…å®¹
client_cert/client_keygen.py	generate_client_keys()	NTRUã¨Dilithiuméµãƒšã‚¢ã‚’ç”Ÿæˆ
client_cert/cert_builder.py	build_client_certificate(...)	NTRUå…¬é–‹éµï¼‹ãã®ä»–ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„
ca/ca_signer.py	sign_certificate(...)	è¨¼æ˜æ›¸ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã« dilithiumç§˜å¯†éµã§ç½²å
client_cert_api.py	/issue_cert API	ä¸Šè¨˜ã‚’é€£æºã—ã€JSONå½¢å¼ã§è¨¼æ˜æ›¸ã¨ç§˜å¯†éµã‚’è¿”å´

âœ” å®Ÿéš›ã®ã€Œç™ºè¡Œã•ã‚Œã‚‹è¨¼æ˜æ›¸ã€ã®ä¸­èº«ï¼ˆä¾‹ï¼‰
{
  "uuid": "xxxx-xxxx",
  "ntru_public": "ABCDEF123456...",        // â˜… ã“ã“ãŒNTRUå…¬é–‹éµ
  "dilithium_public": "789ABCDEF...",
  "valid_from": "2025-04-22T08:00:00Z",
  "valid_to": "2026-04-21T08:00:00Z",
  "issuer": "CustomCA v1",
  "signed_at": "2025-04-22T08:00:05Z",
  "signature": "ã“ã‚Œã¯NTRUç§˜å¯†éµã§æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿"
}

ã¤ã¾ã‚Šã€è¨¼æ˜æ›¸ã®æ§‹æˆè¦ç´ ã¯ï¼š
NTRUæš—å·éµï¼ˆæš—å·ç”¨é€”ï¼‰
Dilithiumç½²åéµï¼ˆç½²åç”¨é€”ï¼‰
ç½²åä»˜ãï¼ˆCAç§éµã§ç½²åï¼‰ ã¨ãªã£ã¦ã„ã¾ã™ã€‚

âœ… ãªãœã€Œæ•°åè¡Œã€ãªã®ã‹ï¼Ÿï¼ˆï¼è‰¯ã„æ„å‘³ï¼‰
ã‚ãªãŸãŒã€Œè¤‡é›‘ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‹ã¨æ€ã£ãŸãŒã€æ•°åè¡Œã§å®Œçµã—ã¦ã„ã¦é©šã„ãŸã€ã¨æ„Ÿã˜ãŸã®ã¯è‡ªç„¶ã§ã™ã€‚

âœ” ç†ç”±ï¼š
æš—å·ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆNTRU/Dilithiumï¼‰è‡ªä½“ã¯åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆä¾‹ï¼šntru.ntruï¼‰ã«ã‚«ãƒ—ã‚»ãƒ«åŒ–ã•ã‚Œã¦ã„ã‚‹
å®Ÿéš›ã®é›£è§£ãªæ•°å¼ã‚„å¤šé …å¼å‡¦ç†ã¯ã€Rustã‚„Cãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å‡¦ç†ã•ã‚Œã€Pythonã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä½¿ãˆã‚‹APIã«ãªã£ã¦ã„ã‚‹ã€‚
è¨¼æ˜æ›¸ã¯å®Ÿã¯ã€Œæ§‹é€ ä½“ã€+ã€Œç½²åã€
é€šå¸¸ã®X.509è¨¼æ˜æ›¸ã‚‚ã€ŒSubject, Issuer, å…¬é–‹éµ, æœ‰åŠ¹æœŸé™ã€ï¼‹ç½²åã‹ã‚‰ãªã£ã¦ãŠã‚Šã€æœ¬è³ªçš„ã«ã¯JSONã§ã‚‚ç°¡æ½”ã«è¨˜è¿°ã§ãã‚‹ã€‚
ç½²åä»˜ãJSONã¨ã„ã†æ§‹æˆãŒç¾ä»£çš„
JWSã‚„Verifiable Credentialãªã©ã§ã‚‚ã€Œç½²åä»˜ãæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã€ã¨ã„ã†è€ƒãˆæ–¹ãŒä¸»æµã€‚

âœ… ä»Šå¾Œã®é¸æŠè‚¢ï¼ˆæ‹¡å¼µæ€§ï¼‰

æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢	èª¬æ˜
PEMå½¢å¼ã«å¤‰æ›	OpenSSLäº’æ›å½¢å¼ã§å¤–éƒ¨é€£æºã‚‚å¯èƒ½ã«ï¼ˆASN.1ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰
QRã‚³ãƒ¼ãƒ‰åŒ–	ç™ºè¡Œè¨¼æ˜æ›¸å…¨ä½“ã‚’base64ã—ã¦QRã§æŒã¡æ­©ã
JSON-LD + VCæº–æ‹ 	DIDã‚„W3Cæº–æ‹ è¨¼æ˜æ›¸ã«é€²åŒ–ã•ã›ã‚‹é“ã‚‚ã‚ã‚Š
AWS KMS ã«CAç§˜å¯†éµã‚’ä¿å­˜	æœ¬ç•ªã§ã¯ç½²åæ“ä½œã®ã¿KMSã«å§”è­²ã™ã‚‹ã“ã¨ã§å®‰å…¨æ€§å‘ä¸Š

âœ… çµè«–
ä»Šã®æ§‹æˆã¯ã€Œè»½é‡ã€ã€Œãƒ¢ãƒ€ãƒ³ã€ã€Œæ‹¡å¼µæ€§ã‚ã‚Šã€
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã¨ã—ã¦ã®å¿…è¦æ¡ä»¶ã¯ã™ã¹ã¦æº€ãŸã—ã¦ãŠã‚Šã€
å®Ÿç”¨ä¸Šã¯ éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰ã§ååˆ†å®‰å…¨ã«é‹ç”¨ ã§ãã¾ã™ã€‚


#ã€€ ã©ã“ã§ã€ŒCA ã‹ã‚‰èªè¨¼ã€ã‚’å—ã‘ã¦ã„ã‚‹ã‹ï¼Ÿ
å—ã‘ã¦ã„ã¾ã›ã‚“ï¼ˆé–‹ç™ºç”¨ãƒ€ãƒŸãƒ¼å®Ÿè£…ï¼‰

client_cert.py::generate_client_certificate() ã§

app_dilithium.create_keypair() ã‹ã‚‰å…¬é–‹éµï¼ç§˜å¯†éµã‚’ç”Ÿæˆ

issuer ã« CA_NAME ã‚’æ›¸ãè¾¼ã¿

signature ã«å›ºå®šæ–‡å­—åˆ— "CA_SIGNATURE_PRODUCTION" ã‚’ç½®ã

å®Ÿé‹ç”¨ãªã‚‰ã“ã“ã§ ãƒ«ãƒ¼ãƒˆ CA ã®ç§˜å¯†éµã§ X.509 ç½²åã—ã¾ã™ãŒã€
ç¾çŠ¶ã¯ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ CA åã‚’åŸ‹ã‚ã‚‹ã ã‘ ã§ã™ã€‚

2. è¨¼æ˜æ›¸ç™ºè¡Œã®è©³ã—ã„ã‚¹ãƒ†ãƒƒãƒ—
app_client_cert.py /client_cert
æ‰‹é †	å ´æ‰€	ç›®çš„
â‘  ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡	/client_cert?uuid=â€¦	UUID å¿…é ˆã€æ—¢ç™ºè¡Œãªã‚‰å†åˆ©ç”¨
â‘¡ generate_client_certificate() å‘¼ã³å‡ºã—	client_cert.py	- Dilithium éµãƒšã‚¢ç”Ÿæˆ
- valid_from / valid_to è¨­å®š
- serial_number ç”Ÿæˆ
- JSON ã‚’ bytes åŒ– & fingerprint è¨ˆç®—
â‘¢ S3 ã«ä¿å­˜	client_cert/<uuid>_<timestamp>.json	è¨¼æ˜æ›¸æœ¬ä½“ (å…¬é–‹éµãƒ»ç§˜å¯†éµå«ã‚€) ã‚’é•·æœŸä¿å­˜
â‘£ DynamoDB ã«ãƒ¡ã‚¿ä¿å­˜	ãƒ†ãƒ¼ãƒ–ãƒ« ClientCertificates	å‚ç…§ã—ã‚„ã™ã„ã‚ˆã†ã«ãƒ¡ã‚¿ã ã‘è¡Œã§æŒã¤
revoked ãƒ•ãƒ©ã‚°ãªã©ã‚‚ã“ã“ã«
â‘¤ ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚‚ã‚³ãƒ”ãƒ¼	login_data/user_client_cert/â€¦ ãªã©	ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼é–‹ç™ºç”¨ç¢ºèª
â‘¥ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹	client_cert ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒç›´æ¥ JSON ã‚’å–å¾—ã—ãŸã„å ´åˆç”¨


#ã€€D:\city_chain_project\CA\ ã‚’ä½œæˆã—ã¦ã€ãã“ã«ã•ã¾ã–ã¾ãªã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ã®ã¯ã©ã†ï¼Ÿ
ChatGPT said:
Reasoned for 12 seconds
D:\city_chain_project\CA\ ã®ã‚ˆã†ãªå°‚ç”¨ãƒ•ã‚©ãƒ«ãƒ€ã«ã€èªè¨¼å±€ï¼ˆCAï¼‰ã®ã‚³ãƒ¼ãƒ‰ã‚„ç®¡ç†ãƒ„ãƒ¼ãƒ«ã‚’åˆ†é›¢ã—ã¦é…ç½®ã™ã‚‹ã®ã¯ã€éå¸¸ã«åˆç†çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å‘ä¸Š
åˆ†é›¢ã«ã‚ˆã‚‹ãƒªã‚¹ã‚¯ä½æ¸›:
CA ã®ã‚³ãƒ¼ãƒ‰ã‚„ç§˜å¯†éµç®¡ç†ã€è¨¼æ˜æ›¸ç™ºè¡Œãªã©ã¯éå¸¸ã«é‡è¦ãªæ©Ÿèƒ½ã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ç‰©ç†çš„ã«åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€ä¸‡ãŒä¸€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã«è„†å¼±æ€§ãŒã‚ã£ã¦ã‚‚ã€CA ã®æ©Ÿå¯†æƒ…å ±ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒªã‚¹ã‚¯ã‚’ä½æ¸›ã§ãã¾ã™ã€‚

ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡:
å°‚ç”¨ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚„å°‚ç”¨ã®ç®¡ç†ç’°å¢ƒï¼ˆVPNã€ç‰©ç†çš„ã«éš”é›¢ã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼ãªã©ï¼‰ã«é…ç½®ã—ã€å¤–éƒ¨ã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç®¡ç†ç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚„è¨¼æ˜æ›¸ç™ºè¡Œå‡¦ç†ã‚’ã‚ˆã‚Šå³é‡ã«ä¿è­·ã§ãã¾ã™ã€‚

2. é‹ç”¨ã¨ç®¡ç†ã®åŠ¹ç‡åŒ–
ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–:
CA ã®æ©Ÿèƒ½ã¯ã€è¨¼æ˜æ›¸ã®ç™ºè¡Œã€å¤±åŠ¹ç®¡ç†ã€æ›´æ–°ã€ç›£æŸ»ãƒ­ã‚°ã®å–å¾—ã€ã•ã‚‰ã«ã¯HSMã¨ã®é€£æºãªã©ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰æˆã‚Šç«‹ã¡ã¾ã™ã€‚å°‚ç”¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ã“ã‚Œã‚‰ã‚’ã¾ã¨ã‚ã¦ãŠãã“ã¨ã§ã€å„æ©Ÿèƒ½ãŒç‹¬ç«‹ã—ã¦é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»é‹ç”¨ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

å°‚ç”¨ç®¡ç†ãƒ„ãƒ¼ãƒ«ã®æ§‹ç¯‰:
CA ã®ç®¡ç†ç”»é¢ï¼ˆç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰ã‚’ä½œæˆã—ã€ç™ºè¡Œæ¸ˆã¿è¨¼æ˜æ›¸ã®ä¸€è¦§è¡¨ç¤ºã€å¤±åŠ¹æ“ä½œã€è¨¼æ˜æ›¸ã®æœ‰åŠ¹æœŸé™ç®¡ç†ãªã©ã®å‡¦ç†ã‚’å†…éƒ¨å‘ã‘ã«å®Ÿè£…ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç®¡ç†è€…ã¯å®‰å…¨ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§CAã®é‹ç”¨çŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ç›£è¦–ãƒ»æ“ä½œã§ãã¾ã™ã€‚

å°†æ¥ã®æ‹¡å¼µæ€§:
åˆ¥ãƒ•ã‚©ãƒ«ãƒ€ã«ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«èªè¨¼å±€å°‚ç”¨ã®APIã‚„CLIãƒ„ãƒ¼ãƒ«ã€Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãªã©ã‚’è¿½åŠ ã—ã¦ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ç‹¬ç«‹ã—ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå¯èƒ½ã§ã™ã€‚

3. æŠ€è¡“çš„ãªå®Ÿè£…ã®ä¾‹
ä¾‹ãˆã°ã€D:\city_chain_project\CA\ é…ä¸‹ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã§ã‚³ãƒ¼ãƒ‰ã‚’é…ç½®ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ï¼š

makefile
Copy
D:\city_chain_project\CA\
â”œâ”€â”€ cert_issuer.py       # è¨¼æ˜æ›¸ç™ºè¡Œã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆéµãƒšã‚¢ç”Ÿæˆã€ç½²åã€è¨¼æ˜æ›¸ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰
â”œâ”€â”€ ca_manager.py        # CAå…¨ä½“ã®é‹ç”¨ãƒ»ç®¡ç†ç”¨ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè¨¼æ˜æ›¸ã®å¤±åŠ¹ã€æ›´æ–°ã€ç›£æŸ»ãƒ­ã‚°ï¼‰
â”œâ”€â”€ config.py            # CAã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæœ‰åŠ¹æœŸé™ã€CAåã€HSMã®è¨­å®šãªã©ï¼‰
â”œâ”€â”€ app_ca.py            # CAç®¡ç†ç”¨ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç®¡ç†ç”»é¢ã€APIï¼‰
â””â”€â”€ tests\
    â””â”€â”€ test_ca.py       # CAãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€CAã®é‹ç”¨ã«é–¢ã™ã‚‹ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã‚„è¨­å®šã‚’ä¸€ç®‡æ‰€ã«ã¾ã¨ã‚ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ç®¡ç†æ€§ãƒ»æ‹¡å¼µæ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

çµè«–
CA ã¯æœ¬ç•ªç’°å¢ƒã§éå¸¸ã«é‡è¦ãªå½¹å‰²ã‚’æœãŸã™ãŸã‚ã€å°‚ç”¨ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆä¾‹ãˆã° D:\city_chain_project\CA\ï¼‰ã«ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã€ç®¡ç†å°‚ç”¨ã®ç’°å¢ƒã‚„ãƒ„ãƒ¼ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹ã®ã¯æ¨å¥¨ã•ã‚Œã‚‹æ–¹æ³•ã§ã™ã€‚
ã“ã®æ–¹æ³•ã§ã‚ã‚Œã°ã€å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒªã‚¹ã‚¯ã‚’æŠ‘ãˆã€ã‚»ã‚­ãƒ¥ã‚¢ãªé‹ç”¨ã‚’å®Ÿç¾ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

ã‚‚ã—å®Ÿéš›ã«ã“ã®æ–¹é‡ã§é€²ã‚ã‚‹å ´åˆã¯ã€ä¸Šè¨˜ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã‚„ãƒ•ã‚¡ã‚¤ãƒ«è¨­è¨ˆã‚’å‚è€ƒã«ã€CAç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆãƒ»å®Ÿè£…ã‚’é€²ã‚ã‚‹ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚


# é–‹ç™ºæ™‚ã®å¯¾å‡¦æ³•
é–‹ç™ºæ®µéšã§ã¯ã€åˆ©ä¾¿æ€§ã®ãŸã‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ Web UI ã‚’åˆ©ç”¨ã—ã¦æ“ä½œã‚„ç¢ºèªãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã¯ä¸€èˆ¬çš„ã§ã™ã€‚ã—ã‹ã—ã€æœ¬ç•ªé‹ç”¨ã«ç§»è¡Œã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

é–‹ç™ºæ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ Web UI ã‚’åˆ©ç”¨:
ãƒ­ãƒ¼ã‚«ãƒ«ã®é–‹ç™ºç’°å¢ƒã§ã¯ã€client_cert_ui() ã‚’æœ‰åŠ¹ã«ã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰è¨¼æ˜æ›¸ã®çŠ¶æ…‹ã‚„æ“ä½œçµæœã‚’ç¢ºèªã™ã‚‹ã®ã¯ä¾¿åˆ©ã§ã™ã€‚
def client_cert_ui():
    """
    CA ç®¡ç†ç”»é¢ï¼ˆWeb UIï¼‰ã‚’è¿”ã™ã€‚templates/client_cert.html ã‚’åˆ©ç”¨ã€‚
    """
    return render_template("client_cert.html")

ãŸã ã—ã€æœ¬ç•ªã§ã¯å¿…ãšã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚’è¡Œã†ã‹ã€Web UI ã‚’å»ƒæ­¢ã—ã¦ CLI ãªã©ã®ã‚»ã‚­ãƒ¥ã‚¢ãªæ‰‹æ®µã«åˆ‡ã‚Šæ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æœ¬ç•ªç’°å¢ƒã§ã¯ç®¡ç†ç”»é¢ã‚’éå…¬é–‹ã«:
æœ¬ç•ªé‹ç”¨æ™‚ã«ã¯ã€CA ç®¡ç†ç”»é¢ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«å…¬é–‹ã›ãšã€å°‚ç”¨ã® VPN å†…éƒ¨ã‚„ CLI ãƒ„ãƒ¼ãƒ«ã«ç½®ãæ›ãˆã‚‹ã€ã¾ãŸã¯å³é‡ã«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã—ãŸç’°å¢ƒã§ã®ã¿åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

ã¾ã¨ã‚ã‚‹ã¨ã€client_cert_ui() ã¯é–‹ç™ºæ™‚ã®æ¤œè¨¼ç”¨ã¨ã—ã¦ã¯æœ‰ç”¨ã§ã™ãŒã€æœ¬ç•ªé‹ç”¨ã§ã¯ã€ãƒªã‚¹ã‚¯ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ç®¡ç†æ“ä½œã¯å°‚ç”¨ã®å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã¾ãŸã¯ CLI ã§è¡Œã†ã®ãŒæœ›ã¾ã—ã„ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚


# ä¿å­˜å…ˆDB,S3
å„ã‚³ãƒ¼ãƒ‰å†…ã§ä½¿ç”¨ã•ã‚Œã‚‹ä¿å­˜å…ˆã¯ã€ç’°å¢ƒå¤‰æ•°ã§æŒ‡å®šã•ã‚Œã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ã‚ã‚Œã¾ã™ã€‚å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ç™ºè¡Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1ï¼‰
S3:
ãƒã‚±ãƒƒãƒˆå: ç’°å¢ƒå¤‰æ•° S3_BUCKET ã®å€¤ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ "my-client-cert-bucket" ã§ã™ã€‚
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: ç’°å¢ƒå¤‰æ•° AWS_REGION ã®å€¤ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ "us-east-1" ã§ã™ã€‚
DynamoDB:
ãƒ†ãƒ¼ãƒ–ãƒ«å: ç’°å¢ƒå¤‰æ•° DYNAMODB_TABLE ã®å€¤ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ "ClientCertificates" ã§ã™ã€‚
ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜:
ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ D:\city_chain_project\login\login_data\user_id_metadata\ ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
è¨¼æ˜æ›¸æœ¬ä½“ï¼ˆJSONå½¢å¼ï¼‰ã¯ D:\city_chain_project\login\login_data\user_client_cert\ ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
CAç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰
S3:
ãƒã‚±ãƒƒãƒˆå: ç’°å¢ƒå¤‰æ•° S3_BUCKET ã®å€¤ã€‚CAç®¡ç†ç”¨ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ "my-ca-bucket" ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ä¾‹ã‚‚ã‚ã‚Šã¾ã™ï¼ˆCA/config.py ã§è¨­å®šå¯èƒ½ï¼‰ã€‚
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: åŒã˜ãç’°å¢ƒå¤‰æ•° AWS_REGION ã®å€¤ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ "us-east-1" ã§ã™ã€‚
DynamoDB:
ãƒ†ãƒ¼ãƒ–ãƒ«å: ç’°å¢ƒå¤‰æ•° DYNAMODB_TABLE ã®å€¤ã€‚CAç®¡ç†ç”¨ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ "CACertificates" ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼ˆCA/config.py ã§è¨­å®šï¼‰ã€‚
ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜:
è¨¼æ˜æ›¸æœ¬ä½“ã¯ D:\city_chain_project\CA\certs\ ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ D:\city_chain_project\CA\metadata\ ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºæ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€S3ã€ãŠã‚ˆã³ DynamoDB ãã‚Œãã‚Œã«è¨¼æ˜æ›¸ç™ºè¡Œæƒ…å ±ãŒä¿å­˜ã•ã‚Œã€å¾Œç¶šã®æ“ä½œï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€å¤±åŠ¹ã€ä¸€è¦§è¡¨ç¤ºãªã©ï¼‰ãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚


# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã™ã‚‹
#ã€€dilithium5 ã‚’åŸ‹ã‚è¾¼ã‚“ã ã®ã§ã€python312ã§ã®ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã¯ä¸‹è¨˜ã‹ã‚‰
# ã¾ãšã¯python312ã«å„ç¨®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä½œæ¥­	å…·ä½“ä¾‹
3.12ã®Python.exeã‚’ç¢ºèª	ï¼ˆãªã‘ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
D:\Python\Python312\python.exe -m venv D:\city_chain_project\.venv312
ä½œã£ãŸã‚ã¨ã€
D:\city_chain_project\.venv312\Scripts\activate.bat
ã¨ã„ã†å…·åˆã«ã€ä»®æƒ³ã«ã¯ã„ã‚‹ã“ã¨ã€‚

D:\Python\Python312\python.exe -m pip install flask flask-cors requests boto3 qrcode pytest PyJWT cryptography pillow qrcode[pil]

ã“ã‚Œã«ã‚ˆã‚Šã€Python 3.12 ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã€æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã® Pillowï¼ˆPILï¼‰ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚


#ã€€dilithium5.generate_keypair() ã‚’å…ˆã«ä½œæˆã—ã¦ãŠã„ã¦ã‹ã‚‰ãƒ†ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
ã€å…ˆã«å®Ÿè¡Œç‰ˆã€‘CA/init_ca_keys.py 
// CA/init_ca_keys.py

import os
import json
import sys

// dilithium-py ã‚’ä½¿ã†
sys.path.append(os.path.abspath("D:\\city_chain_project\\ntru\\dilithium-py"))
import app_dilithium  # â†ã‚ãªãŸã®dilithiumãƒ©ãƒƒãƒ‘ãƒ¼

// ä¿å­˜å…ˆãƒ‘ã‚¹
KEY_DIR = "CA/keys"
os.makedirs(KEY_DIR, exist_ok=True)

// Dilithiuméµç”Ÿæˆ
public_key, private_key = app_dilithium.create_keypair()

// ãƒªã‚¹ãƒˆãªã‚‰ bytes ã«å¤‰æ›ã—ã¦ã‹ã‚‰ hexåŒ–ã™ã‚‹
def to_hex(data):
    if isinstance(data, list):
        return bytes(data).hex()
    elif isinstance(data, bytes):
        return data.hex()
    else:
        raise ValueError("Unexpected key type")

// ä¿å­˜å†…å®¹
ca_key_data = {
    "private_key": to_hex(private_key),
    "public_key": to_hex(public_key),
    "issuer": "ExampleCA",
    "created_at": "2025-04-24"
}

// ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«
output_path = os.path.join(KEY_DIR, "ca_private.json")
with open(output_path, "w") as f:
    json.dump(ca_key_data, f, indent=4)

print(f"âœ… CAéµã‚’ä¿å­˜ã—ã¾ã—ãŸ: {output_path}")
ã“ã‚Œã§ã€æ­£ã—ã„Dilithiumç”¨ã®ca_private.jsonãŒä½œã‚Œã¾ã™ï¼ï¼
ãƒ•ã‚¡ã‚¤ãƒ«ä¸­èº«ã¯ã€16é€²æ–‡å­—åˆ—ã«ãªã‚Šã¾ã™ã€‚


#ã€€dilithium5 ã‚’åŸ‹ã‚è¾¼ã‚“ã ã®ã§ã€python312ã§ã®ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã¯ä¸‹è¨˜ã‹ã‚‰
python D:\city_chain_project\CA\serve_ca.py
python D:\city_chain_project\CA\test_ca.py

# ãƒ†ã‚¹ãƒˆçµæœ
PS D:\city_chain_project> python -m CA.test_ca
D:\Python\Python314\Lib\site-packages\botocore\auth.py:425: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  datetime_now = datetime.datetime.utcnow()
D:\city_chain_project\CA\cert_issuer.py:42: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  valid_from = datetime.utcnow()
D:\city_chain_project\CA\app_ca.py:50: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  timestamp_str = datetime.utcnow().strftime("%Y%m%d%H%M%S")
D:\city_chain_project\CA\app_ca.py:67: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  "issued_at": datetime.utcnow().isoformat() + "Z"
..D:\city_chain_project\CA\ca_manager.py:28: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  revoked_at = datetime.utcnow().isoformat() + "Z"
.
----------------------------------------------------------------------
Ran 3 tests in 16.083s

OK
PS D:\city_chain_project> 


# http://127.0.0.1:6001/client_cert_ui ã«ã¦é–‹ç™ºç”¨ã®ç”»é¢ãŒè¦‹ã‚Œã‚‹
CA ç®¡ç†ç”»é¢
ã“ã®ç”»é¢ã¯é–‹ç™ºç”¨ã§ã™ã€‚è¨¼æ˜æ›¸ã®ä¸€è¦§ã‚„çŠ¶æ…‹ç¢ºèªã€å¤±åŠ¹æ“ä½œãªã©ã‚’è¡Œã„ã¾ã™ã€‚

è¨¼æ˜æ›¸ä¸€è¦§ã‚’æ›´æ–°
UUID	ç™ºè¡Œæ—¥æ™‚	æœ‰åŠ¹æœŸé™	çŠ¶æ…‹	æ“ä½œ
ca-test-uuid-002	2025-03-22T09:03:52.838041Z	2026-03-22T09:03:52.410615Z	å¤±åŠ¹æ¸ˆã¿	å¤±åŠ¹ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰


# æœ¬ç•ªã® CA ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ä»–ç¤¾ã«æä¾›ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®â€œã‚·ã‚¹ãƒ†ãƒ ï¼é‹ç”¨â€ãƒ¬ãƒ™ãƒ«ã®å¼·åŒ–ãŒä¸å¯æ¬ ã§ã™
é …ç›®;	  PoC ãƒ¬ãƒ™ãƒ«ï¼ˆç¾çŠ¶ï¼‰;	  æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹æ°´æº–ã«å¿…è¦ãªå¯¾å¿œ
è¨¼æ˜æ›¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ;	 JSON + Base64 ã®ã‚«ã‚¹ã‚¿ãƒ æ§‹é€ ;	X.509 v3 DER/PEM ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€OIDï¼ˆãƒã‚¹ãƒˆé‡å­ç”¨ OIDï¼‰ã‚’æ­£ã—ãåŸ‹ã‚è¾¼ã‚€
ç½²åãƒ—ãƒ­ã‚»ã‚¹;	  CAç§˜å¯†éµã§ NTRU æš—å·åŒ–ã«ã‚ˆã‚‹ã€Œæ¨¡æ“¬ç½²åã€;	  Dilithium ã‚’ä½¿ã£ãŸçœŸæ­£ãª CMS/PKCS#7 ç½²åã€è¨¼æ˜æ›¸ç½²åã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆsigAlgï¼‰æŒ‡å®š
éµç®¡ç†;	ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹;	  HSMï¼ˆHardware Security Moduleï¼‰ã«ã‚ˆã‚‹éµç”Ÿæˆï¼†ä¿è­·ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
è¨¼æ˜æ›¸å¤±åŠ¹ç®¡ç†;	ãªã—;	  CRL/OCSP ã«ã‚ˆã‚‹å³æ™‚å¤±åŠ¹é€šçŸ¥ã€OCSP ã‚¹ãƒ†ãƒ¼ãƒ—ãƒ«ã€è¨¼æ˜æ›¸é€æ˜æ€§ãƒ­ã‚°ï¼ˆCT Logsï¼‰
ç›£æŸ»ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹;	  ãƒ­ãƒ¼ã‚«ãƒ«ãƒ­ã‚°ã®ã¿;	  RFC 5280 æº–æ‹ ã®ç›£æŸ»ãƒ­ã‚°ã€å¤–éƒ¨ç›£æŸ»ã€WebTrust/ETSI ãªã©ã®èªè¨¼å–å¾—
é‹ç”¨æ‰‹é †ï¼ãƒãƒªã‚·ãƒ¼;	  ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰;  	CP/CPSï¼ˆCertificate Policy/Practice Statementï¼‰æ–‡æ›¸åŒ–
ã‚¤ãƒ³ã‚¿ãƒ¼ã‚ªãƒšãƒ©ãƒ“ãƒªãƒ†ã‚£;	  ç‹¬è‡ª;    API	ACME ã‚„ EST ãªã©ãŠã‚ˆã³æ—¢å­˜ PKI/LDAP é€£æºã€æ—¢å­˜ TLS ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå¯¾å¿œ


# X.509/PEMï¼‹OIDå¯¾å¿œ	
âœ‹ å¾Œå›ã—ã§ã„ã„	è¦ä»¶æ¬¡ç¬¬ã§åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã€€ã¨ã„ã†ãŒã€ã“ã‚Œã¯ã©ã†ã„ã†å‡¦ç†ãªã®ï¼Ÿè§£èª¬ã—ã¦

ChatGPT said:
â€œX.509/PEMï¼‹OIDå¯¾å¿œâ€ã¨ã„ã†ã®ã¯ã€ã„ã‚ã‚†ã‚‹ã€Œæœ¬æ ¼çš„ãªè¨¼æ˜æ›¸é‹ç”¨ã€ã®ãŸã‚ã®æ©Ÿèƒ½ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚å¤§ã¾ã‹ã«è¨€ã†ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†é …ç›®ã§ã™ã€‚

X.509 ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã‚µãƒãƒ¼ãƒˆ
ç¾çŠ¶ã¯ãŠãã‚‰ãJSONã§è¨¼æ˜æ›¸å†…å®¹ã‚’ã‚„ã‚Šå–ã‚Šã—ã¦ã„ã¾ã™ãŒã€å®Ÿé‹ç”¨ã§ã¯æ¥­ç•Œæ¨™æº–ã® X.509 è¨¼æ˜æ›¸ï¼ˆASN.1â†’DERï¼‰ã‚’ä½¿ã„ã¾ã™ã€‚
X.509 ã¯â€œSubjectâ€â€œIssuerâ€â€œæœ‰åŠ¹æœŸé™â€â€œã‚·ãƒªã‚¢ãƒ«ç•ªå·â€â€œæ‹¡å¼µé ˜åŸŸâ€ãªã©ã‚’å®šç¾©ã—ãŸä»•æ§˜ã§ã™ã€‚

PEM ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
DERï¼ˆäºŒé€²æ•°ï¼‰ã®ãƒã‚¤ãƒŠãƒªè¨¼æ˜æ›¸ã‚’ Base64 ã«å¤‰æ›ã—ã€
-----BEGIN CERTIFICATE-----
ï¼ˆBase64ãƒ‡ãƒ¼ã‚¿ï¼‰
-----END CERTIFICATE-----
ã¨ã„ã£ãŸâ€œPEMâ€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§é…å¸ƒã—ã¾ã™ã€‚å¤šãã®ãƒ„ãƒ¼ãƒ«ï¼ˆOpenSSLã€ãƒ–ãƒ©ã‚¦ã‚¶ã€OSï¼‰ãŒPEMã‚’å‰æã«æ‰±ã†ã®ã§ã€PEMå‡ºåŠ›ã¯å¿…é ˆã§ã™ã€‚

OIDï¼ˆObject Identifierï¼‰ã®å–ã‚Šæ‰±ã„
X.509è¨¼æ˜æ›¸ã®æ‹¡å¼µé ˜åŸŸï¼ˆextensionsï¼‰ã‚„ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã¯ã™ã¹ã¦OIDã§è­˜åˆ¥ã—ã¾ã™ã€‚
ãŸã¨ãˆã°ã€Œçµ„ç¹”å(2.5.4.10)ã€ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹(1.2.840.113549.1.9.1)ã€ã®ã‚ˆã†ã«ã€å±æ€§ã”ã¨ã«OIDã‚’æŒ¯ã‚Šåˆ†ã‘ã¦DERæ§‹é€ ã«åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚ã•ã‚‰ã«ã€ç‹¬è‡ªã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¨¼æ˜æ›¸ã«æŒãŸã›ãŸã„å ´åˆã¯ã€è‡ªåˆ†ã§OIDã‚’ç™»éŒ²ï¼ˆã¾ãŸã¯ãƒ†ã‚¹ãƒˆç”¨ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆOIDã‚’å‰²ã‚ŠæŒ¯ã‚Šï¼‰ã—ã¦æ‹¡å¼µé ˜åŸŸã«è¼‰ã›ã¾ã™ã€‚

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ãƒ„ãƒ¼ãƒ«ã®çµ±åˆ
Pythonãªã‚‰ cryptography ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ OpenSSL CLI ã‚’å‘¼ã³å‡ºã—ã¦ X.509/PEM ã®ç”Ÿæˆãƒ»æ¤œè¨¼ã‚’è¡Œã†ã®ãŒå®šçŸ³ã§ã™ã€‚
ã„ã¾ã®ã‚·ãƒ³ãƒ—ãƒ«ãªJSONï¼‹æ‰‹ä½œã‚Šç½²åã§ã¯ãªãã€ASN.1â†’DERâ†’PEM ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’çµ„ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã€Œå¾Œå›ã—ã«ã§ãã‚‹ã€ï¼ã€Œåˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã§ãã‚‹ã€ç†ç”±
ãƒ»åˆæœŸãƒ•ã‚§ãƒ¼ã‚º
ã¾ãšã¯æ©Ÿèƒ½æ¤œè¨¼ã‚„ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã¨ã—ã¦ã€JSONãƒ™ãƒ¼ã‚¹ã§è¨¼æ˜æ›¸ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã„ã€å†…éƒ¨çš„ãªâ€œæ“¬ä¼¼ç½²åâ€ã§å‹•ã‹ã™ã€‚
ãƒ†ã‚¹ãƒˆã‚‚JSONâ†’Base64â†’ãƒ‘ãƒ¼ã‚¹ã¨ã„ã†ç°¡æ˜“çš„ãªæµã‚Œã§æ¸ˆã‚€ã€‚

ãƒ»æœ¬ç•ªãƒ•ã‚§ãƒ¼ã‚º
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚„æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ é€£æºã®è¦ä»¶ãŒå‡ºã¦ããŸã‚‰ã€X.509/PEMï¼‹OIDå¯¾å¿œã‚’è¡Œã†ã€‚
ãã‚Œã‚’è¡Œã†ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã¯å¤§è¦æ¨¡ã«ãªã‚ŠãŒã¡ï¼ˆASN.1ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã€å„ç¨®æ‹¡å¼µã‚µãƒãƒ¼ãƒˆã€è¨¼æ˜æ›¸å¤±åŠ¹ãƒªã‚¹ãƒˆå¯¾å¿œãªã©ï¼‰ã€‚
ã—ãŸãŒã£ã¦åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¦ä¿å®ˆã—ãŸã»ã†ãŒåŠ¹ç‡çš„ã€ã¨ã„ã†åˆ¤æ–­ãŒå¤šã„ã‹ã‚‰ã§ã™ã€‚

ã¾ã¨ã‚ã‚‹ã¨ï¼š
X.509 â†’ ã€Œæœ¬æ ¼çš„ãªè¨¼æ˜æ›¸ä»•æ§˜ãã®ã¾ã¾ã€
PEM â†’ Base64ï¼‹ãƒ˜ãƒƒãƒ€/ãƒ•ãƒƒã‚¿ã®ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼
OID â†’ è¨¼æ˜æ›¸ã®å±æ€§ã‚„æ‹¡å¼µã‚’è­˜åˆ¥ã™ã‚‹ä¸€æ„ã®ç•ªå·

ã“ã‚Œã‚‰ã‚’ã‚ã¨ã‹ã‚‰æœ¬ç•ªå“è³ªã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã«ã¯ã€ASN.1/DERâ†’PEMã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚„ã€OIDã‚’ä½¿ã£ãŸæ‹¡å¼µé ˜åŸŸã®æ§‹ç¯‰ãƒ»è§£æã®ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ±åˆãŒå¿…è¦ã«ãªã‚‹ã€ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚è¦ä»¶ãŒå›ºã¾ã‚Šæ¬¡ç¬¬ã€åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚„ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè£…ã‚’é€²ã‚ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚

âœ…ã‚ãªãŸã®ã‚„ã‚ŠãŸã„ã“ã¨ï¼ˆã¾ã¨ã‚ï¼‰

é …ç›®	å†…å®¹	ã‚³ãƒ¡ãƒ³ãƒˆ
1.	ç‹¬è‡ªã®CAã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚‹	ã¯ã„ã€ãã®é€šã‚Šã€‚ã‚ãªãŸè‡ªèº«ãŒãƒ«ãƒ¼ãƒˆCAã«ãªã‚‹
2.	ç‹¬è‡ªã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ç™ºè¡Œã™ã‚‹	ã¯ã„ã€ãã®é€šã‚Šã€‚è‡ªåˆ†ã®CAã§ç½²åã—ã¦ç™ºè¡Œ
3.	è¨¼æ˜æ›¸å½¢å¼ã¯PEMã«ã™ã‚‹	ã¯ã„ã€å¿…é ˆã€‚æºå¸¯ç«¯æœ«ã§ã‚‚PEMå½¢å¼ãŒæ¨™æº–
4.	è¨¼æ˜æ›¸ã®å…¬é–‹éµéƒ¨åˆ†ã¯NTRUæš—å·ã‚’ä½¿ã†	ã¯ã„ã€ã“ã“é‡è¦ï¼RSA/ECDSAã§ã¯ãªãNTRUã‚’çµ„ã¿è¾¼ã‚€
5.	è¨¼æ˜æ›¸ã®ç½²åã¯dilithium5ã§è¡Œã†	ã¯ã„ã€ã“ã‚Œã‚‚è¶…å¤§äº‹ï¼é‡å­è€æ€§ã®ã‚ã‚‹ç½²åã‚’ä½¿ã†
6.	å°†æ¥çš„ã«ã¯CAæ¥­å‹™ã‚’å¤–éƒ¨å§”è¨—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹	ã¯ã„ã€ãã®ãŸã‚ã«æ¨™æº–çš„ãªX.509/PEMæ§‹é€ ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹
7.	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ç«¯æœ«ï¼ˆã‚¹ãƒãƒ›ï¼‰ã«ä¿å­˜ã™ã‚‹	ã¯ã„ã€ãã®ãŸã‚ã«PEMåŒ–ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹
8.	é€šä¿¡æ™‚ã«ç«¯æœ«å´ã§ã•ã‚‰ã«dilithiumç½²åã‚’ä»˜åŠ ã™ã‚‹

ğŸ”¥å…·ä½“çš„ã«ã¯ã“ã†æ•´ç†ã—ã¦ææ¡ˆã™ã‚‹ï¼

ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…å®¹	è¿½åŠ ã™ã‚‹å ´æ‰€	ç†ç”±
CAãŒã€ŒCAè¨¼æ˜æ›¸ï¼ˆè‡ªå·±ç½²åï¼‰ã€ã‚’ä½œæˆã™ã‚‹	D:\city_chain_project\CA\ ã«å…¥ã‚Œã‚‹	ã“ã‚Œã¯ã€Œèªè¨¼å±€ã€ãŒç®¡ç†ã™ã‚‹ã¹ãã ã‹ã‚‰
CAãŒã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã€ã‚’ç™ºè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ	åŒã˜ã D:\city_chain_project\CA\ ã«å…¥ã‚Œã‚‹	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ç™ºè¡Œã™ã‚‹ã®ã‚‚CAã®ä»•äº‹ã ã‹ã‚‰
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’å—ã‘å–ã£ã¦ä¿å­˜ã™ã‚‹å‡¦ç†ã€	D:\city_chain_project\login\auth_py\client_cert\ ã«å…¥ã‚Œã‚‹	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ç®¡ç†ã™ã‚‹ã¹ãã ã‹ã‚‰
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ä½¿ã£ãŸèªè¨¼ã®ä»•çµ„ã¿	ã™ã§ã«ã‚ã‚‹D:\city_chain_project\login\auth_py\ã«è¿½åŠ ãƒ»æ”¹è‰¯ã™ã‚‹	èªè¨¼å‡¦ç†ã®ä¸­ã§è¨¼æ˜æ›¸æ¤œè¨¼ã‚’ã‚„ã‚‹ã‹ã‚‰
è¨¼æ˜æ›¸ç™»éŒ²æ™‚ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ï¼‰ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ã‚»ãƒƒãƒˆã™ã‚‹å‡¦ç†	D:\city_chain_project\login\registration\ã«è¿½åŠ 	æ–°è¦ç™»éŒ²æ™‚ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚‚ã‚»ãƒƒãƒˆã—ãŸã„å ´åˆ


âœ…ã¤ã¾ã‚Šã€æ–°ã—ãä½œã‚‹ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€ã¯
ã‚ãªãŸã®ã„ã¾ã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã‚’å°Šé‡ã—ã¦ã€

å¿…è¦ãªå ´æ‰€ã«ã ã‘æ–°ã—ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ï¼

ç„¡ç†ã«æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã£ãŸã‚Šã€å…¨ä½“æ§‹æˆã‚’å£Šã—ãŸã‚Šã—ãªã„ã§ã™ã€‚

ğŸ“‚ã‚¤ãƒ¡ãƒ¼ã‚¸ä¾‹ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ ä¾‹ï¼‰

ãƒ‘ã‚¹	ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä»®ï¼‰	å†…å®¹
D:\city_chain_project\CA\	ca_generate_cert.py	CAè¨¼æ˜æ›¸ï¼ˆè‡ªå·±ç½²åï¼‰ã‚’ä½œã‚‹
D:\city_chain_project\CA\	ca_issue_client_cert.py	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ç™ºè¡Œã™ã‚‹
D:\city_chain_project\login\auth_py\client_cert\	client_cert_handler.py	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ä¿å­˜ãƒ»ç®¡ç†ã™ã‚‹
D:\city_chain_project\login\auth_py\	auth_with_cert.py	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ä½¿ã£ãŸèªè¨¼
D:\city_chain_project\login\registration\	register_with_cert.py	ç™»éŒ²æ™‚ã«è¨¼æ˜æ›¸ã‚‚ç™»éŒ²ã™ã‚‹


# è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ ã§ X.509/PEM ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿç¾ã—ã¾ã™
ã“ã†ã—ã¦ãŠã‘ã°ã€
æ—§ JSON ãƒ™ãƒ¼ã‚¹ ã¨ æ–° X.509 ãƒ™ãƒ¼ã‚¹ ã®å‡¦ç†ç³»ã‚’ æ®µéšçš„ã«åˆ‡ã‚Šæ›¿ãˆ ã‚‰ã‚Œã‚‹ã‹ã‚‰ã€
å‹•ä½œç¢ºèªãƒ»ç§»è¡Œãƒ†ã‚¹ãƒˆã‚‚å®‰å…¨ã«ã§ãã¾ã™ã€‚

ä½¿ã„æ–¹ã–ã£ãã‚Šãƒ•ãƒ­ãƒ¼
(.venv312) $ python CA/ca_generate_cert.py          # â† ãƒ«ãƒ¼ãƒˆ CA PEM ã¨ç§˜å¯†éµã‚’ä½œæˆ
(.venv312) $ python CA/ca_issue_client_cert.py      # â† ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ PEM ã‚’ç™ºè¡Œ
ç”Ÿæˆã•ã‚ŒãŸ PEM ã‚’

ã‚¹ãƒãƒ›ç«¯æœ«å´ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

Flask å´ API ã§é…å¸ƒï¼æ¤œè¨¼
â€¦â€¦ã¨ã„ã†é †ã«æ‹¡å¼µã—ã¦ã„ã‘ã°ã€ã‚ãªãŸãŒæ€ã„æã PQC å¯¾å¿œ CA / ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸åŸºç›¤ ãŒãã®ã¾ã¾æ§‹ç¯‰ã§ãã¾ã™ï¼


# ãƒ•ã‚§ãƒ¼ã‚º	ã‚„ã‚‹ã“ã¨	å…·ä½“å†…å®¹
A. SPKIã‚’ä½œã‚‹	NTRUå…¬é–‹éµã‚’ ã€ŒSubjectPublicKeyInfoã€ æ§‹é€ ã«è¼‰ã›ã‚‹	
 â‘  AlgorithmIdentifier ã« NTRU ç”¨ã® OID ã‚’å…¥ã‚Œã‚‹
 â‘¡ BIT STRING ã« NTRU å…¬é–‹éµãƒã‚¤ãƒˆåˆ—ã‚’ãã®ã¾ã¾å…¥ã‚Œã‚‹
B. TBSCertificateã‚’ä½œã‚‹	X.509 ã®æœ¬ä½“ï¼ˆç½²åå‰ï¼‰ã‚’ ASN.1 ã§çµ„ã‚€	asn1crypto.x509.TbsCertificate ã‚’æ‰‹æ§‹ç¯‰
C. ç½²åã™ã‚‹	TBSCertificate DER ã« Dilithium5 ã§ç½²å	dilithium_app.sign_message(tbs_der, dil_priv)
D. Certificateã‚’å®Œæˆ	TBSCertificate + AlgorithmIdentifier + Signature	ç½²åã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ Dilithium OID ã‚’ä½¿ã†
E. PEMåŒ–	DER ã‚’ Base64 + header/footer	-----BEGIN CERTIFICATE----- â€¦

 å‰æï¼šCAè¨¼æ˜æ›¸ï¼ˆPEMå½¢å¼ï¼‰ã®ä¸­èº«ã¨æ§‹é€ 
CAï¼ˆèªè¨¼å±€ï¼‰ã®PEMãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€è¨¼æ˜æ›¸æƒ…å ±ï¼ˆX.509å½¢å¼ï¼‰ãŒãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸­èº«ã¯æ¬¡ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ï¼š

-----BEGIN CERTIFICATE-----
ï¼ˆBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸX.509è¨¼æ˜æ›¸ï¼‰
-----END CERTIFICATE-----
ã“ã®Base64éƒ¨åˆ†ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€ä¸­èº«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒã‚¤ãƒŠãƒªå½¢å¼ã®X.509æ§‹é€ ã§ã™ï¼š

markdown
Copy
Edit
Certificate
 â””â”€â”€ TBSCertificate
     â”œâ”€â”€ subjectPublicKeyInfoï¼ˆSPKIï¼‰â†ã“ã“ã«ã€Œå…¬é–‹éµã€ãŒå…¥ã£ã¦ã„ã‚‹ï¼
     â”œâ”€â”€ extensionsï¼ˆæ‹¡å¼µé ˜åŸŸï¼‰â†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§è¿½åŠ æƒ…å ±ã‚’å…¥ã‚Œã‚‰ã‚Œã‚‹ï¼
     â””â”€â”€ ãã®ä»–ã®ç½²åã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€æœ‰åŠ¹æœŸé–“ã€ç™ºè¡Œè€…ãªã©

SPKIã¯ã€å…¬é–‹éµã«é–¢ã™ã‚‹æƒ…å ±ã‚’å«ã‚€é ˜åŸŸã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã§ã™ï¼š
SPKI:
 â”œâ”€â”€ AlgorithmIdentifierï¼ˆéµã®ç¨®é¡ã‚’è­˜åˆ¥ã€ä¾‹ï¼šRSAã€ECDSAã€NTRU ãªã©ï¼‰
 â””â”€â”€ SubjectPublicKeyï¼ˆå®Ÿéš›ã®å…¬é–‹éµãƒ‡ãƒ¼ã‚¿ï¼‰
ã¤ã¾ã‚Šã€1ã¤ã®è¨¼æ˜æ›¸ã«ã¯åŸå‰‡1ã¤ã®SPKIã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚
**1è¨¼æ˜æ›¸ = 1å…¬é–‹éµï¼ˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰**ã¨ã„ã†åˆ¶é™ã§ã™ã€‚


ã˜ã‚ƒã‚ã€ã©ã“ã«2ã¤å…¥ã‚Œã‚‹ã®ã‹ï¼Ÿ
è¨¼æ˜æ›¸ã®ã“ã®éƒ¨åˆ†ï¼š

python
Copy
Edit
spki = rfc5280.SubjectPublicKeyInfo()
ã“ã® spki ã¯ã“ã†ã„ã†æ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ï¼š
SubjectPublicKeyInfo  ::=  SEQUENCE  {
    algorithm            AlgorithmIdentifier,
    subjectPublicKey     BIT STRING
}
ãã‚Œãã‚Œï¼š

algorithm â†’ éµã®ç¨®é¡ï¼ˆä¾‹ï¼šRSAã¨ã‹NTRUã¨ã‹ï¼‰
subjectPublicKey â†’ å…¬é–‹éµæœ¬ä½“ï¼ˆãƒã‚¤ãƒˆåˆ—ï¼‰
parameters â†’ å®Ÿã¯ã“ã“ã«ã€Œè¿½åŠ ãƒ‡ãƒ¼ã‚¿ã€ã‚‚å…¥ã‚Œã‚‰ã‚Œã‚‹ï¼ˆä»Šå›ä½¿ã†å ´æ‰€ï¼‰

ğŸ§ ã©ã†ã‚„ã£ã¦ã€Œ2ã¤ã®éµã€ã‚’å…¥ã‚Œã‚‹ã®ï¼Ÿ
ğŸ¯ç­”ãˆï¼š
subjectPublicKey ã«ï¼šNTRU å…¬é–‹éµ
algorithm.parameters ã«ï¼šDilithium å…¬é–‹éµ

ğŸ‘‡ã‚³ãƒ¼ãƒ‰ã§è¦‹ã‚‹ã¨ã“ã†ãªã‚Šã¾ã™
spki = rfc5280.SubjectPublicKeyInfo()
spki['algorithm']['algorithm'] = OID_NTRU_ALG

# âœ…ã“ã“ã«å…¥ã‚‹ã®ãŒãƒ¡ã‚¤ãƒ³ã®å…¬é–‹éµï¼ˆä»Šå›ã¯ NTRUï¼‰
spki['subjectPublicKey'] = univ.BitString.fromOctetString(ntru_pub)

# âœ…ã“ã“ã«å…¥ã‚Œã‚‹ã®ãŒã€Œè¿½åŠ ã®æƒ…å ±ã€ï¼ˆä»Šå›ã¯ Dilithium å…¬é–‹éµï¼‰
spki['algorithm']['parameters'] = univ.OctetString(dil_pub)


â“ã“ã‚Œã£ã¦æ­£ã—ã„ã®ï¼Ÿ
æŠ€è¡“çš„ã«ã¯OKã§ã™ã€‚ã¨ã„ã†ã®ã‚‚ã€X.509è¨¼æ˜æ›¸ã®ä»•æ§˜ã§ã¯ AlgorithmIdentifier ã«å«ã¾ã‚Œã‚‹ parameters ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€Œä»»æ„ï¼ˆoptionalï¼‰ã€ã§ã€ã—ã‹ã‚‚ ANY å‹ãªã®ã§ã€ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªç”±ã«å…¥ã‚Œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¤ã¾ã‚Šã€èª°ãŒæ±ºã‚ãŸæ¨™æº–ã«å¾“ã†å¿…è¦ãŒãªã„å†…éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚Œã°ï¼š

âœ… è‡ªç”±ã«æ„å‘³ã‚’æ±ºã‚ã¦ä½¿ã£ã¦ã‚ˆã„
ã¨ã„ã†ã®ãŒä»Šå›ã®å‰æã§ã™ã€‚

ğŸ§ªã˜ã‚ƒã‚ã©ã†ã‚„ã£ã¦å–ã‚Šå‡ºã™ã®ï¼Ÿ
è¨¼æ˜æ›¸ã‚’èª­ã‚€ã¨ãã«ã¯ï¼š
ntru_pub = cert['tbsCertificate']['subjectPublicKeyInfo']['subjectPublicKey'].asOctets()
dil_pub  = cert['tbsCertificate']['subjectPublicKeyInfo']['algorithm']['parameters'].asOctets()
ã“ã®ã‚ˆã†ã«ã—ã¦ã€2ã¤ã®éµã‚’å–ã‚Šå‡ºã›ã¾ã™ï¼


# PEMã«æ‹¡å¼µãŒä»˜ã„ã¦ã„ã‚‹ã‹ã®ãƒ†ã‚¹ãƒˆ
CA/test_ca_extension.py ã‚’æ–°è¦ä½œæˆ
CA/certs ãƒ•ã‚©ãƒ«ãƒ€ã«ç”Ÿæˆæ¸ˆã¿ã® ca_root_*.pem ã‚’ç½®ã„ã¦
pytest CA/test_ca_extension.py ã‚’å®Ÿè¡Œ

ã“ã‚Œã§ã¾ãšã€ŒCA ã® PEM ã«æ‹¡å¼µãŒæœ¬å½“ã«ä¹—ã£ã¦ã„ã‚‹ã‹ã€ã ã‘ã‚’ç¢ºèªã§ãã¾ã™ã€‚ã‚‚ã—ã“ã“ãŒé€šã‚Œã°ã€æ¬¡ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã®ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã«æˆ»ã‚Šã¾ã—ã‚‡ã†ã€‚

# pyasn1ã®ãƒ†ã‚¹ãƒˆã€€ï¼ˆtest_pyasn1.pyï¼‰
ã¾ãšãƒ†ã‚¹ãƒˆç”¨PEMã‚’ä½œæˆã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã®pyasn1-masterã‚’å‹•ã‹ã™ã€‚
pyasn1-master/pyasn1/codec/ber/decoder.pyã€€ã«printæ–‡ï¼ˆ1750è¡Œç›®ã‚ãŸã‚Šï¼‰ã‚’åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹
ã“ã‚Œã‚’å‡ºåŠ›ã•ã›ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚

cd D:\city_chain_project\openssl-src-rs\OpenSSL-Win64\bin
.\openssl.exe version

ã“ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸï¼š
OpenSSL 1.1.1u  30 May 2023

ã‚¹ãƒ†ãƒƒãƒ—2ï¼šè‡ªå·±ç½²åè¨¼æ˜æ›¸ã‚’ä½œæˆã™ã‚‹
åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
.\openssl.exe req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 1 -nodes -subj "/CN=T

âœ… ã‚¹ãƒ†ãƒƒãƒ—3ï¼šcert.pem ã‚’ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼
ãŸã¨ãˆã°ï¼š
D:\city_chain_project\CA\client_certs\client_demo_test.pem

âœ… ã‚¹ãƒ†ãƒƒãƒ—4ï¼šãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
å…ˆã»ã©ã® test_pyasn1.py ã‚’å®Ÿè¡Œã™ã‚Œã°ã€
decoder.py ã«åŸ‹ã‚è¾¼ã‚“ã  print() ãŒã™ã¹ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

ãªãŠã€ã¡ã‚ƒã‚“ã¨dilithiumãŒä»˜ã„ã¦ã„ã‚‹ã“ã¨ã‚’ä¸‹è¨˜ã§ç¢ºèªæ¸ˆã¿ã€‚
(.venv312) D:\city_chain_project\CA>openssl x509 -in D:\city_chain_project\CA\client_certs\client_demo_1f98bc2509db41339d45cee414506076.pem -inform pem -noout -text
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            81:7d:90:3d:bc:f3:44:54:9c:ba:d1:19:db:8c:39:f0
        Signature Algorithm: 1.3.6.1.4.1.99999.1.100
        Issuer: CN = MyProductionCA
        Validity
            Not Before: May  1 20:26:11 2025 GMT
            Not After : May  1 20:26:11 2026 GMT
        Subject: CN = demo-client-01
        Subject Public Key Info:
            Public Key Algorithm: 1.3.6.1.4.1.99999.1.0
            Unable to load Public Key
AC1D0000:error:03000072:digital envelope routines:X509_PUBKEY_get0:decode error:crypto\x509\x_pubkey.c:458:
AC1D0000:error:03000072:digital envelope routines:X509_PUBKEY_get0:decode error:crypto\x509\x_pubkey.c:458:
    Signature Algorithm: 1.3.6.1.4.1.99999.1.100
    Signature Value:
        bb:33:ab:b5:e0:c0:dc:14:37:3e:c5:e4:bb:c8:e8:35:33:95:
        6f:f3:12:c9:54:62:77:b1:b9:99:45:99:91:4b:c4:1e:a7:86:
        83:27:28:49:3b:ab:d4:2d:b6:14:8a:0f:6c:22:b0:55:c3:ef:
        98:2c:1f:a2:2a:87:c8:46:17:61:a2:23:53:3a:24:85:aa:4c:
        ee:9b:dd:fd:ee:d4:21:d4:9a:4a:3c:cf:cd:57:50:3e:ed:af:
        11:67:26:1e:1e:b0:a7:f0:dd:68:91:1b:76:d5:74:ea:8f:44:
        3b:ad:33:6f:7d:df:bd:6d:79:b7:dc:1a:bd:6c:36:1b:71:30:
        31:ce:a7:5a:b5:d6:06:5e:fe:94:6b:a3:1e:f2:18:f2:0d:30:
        bd:24:ac:8c:b6:e2:3e:b0:73:21:29:b2:29:a9:c7:00:19:dd:
        a7:4b:2e:4d:e8:3a:52:00:43:82:23:7a:31:ef:78:86:9c:85:
        6f:3d:b4:ee:79:f8:dd:99:06:4f:3a:72:ed:cc:d4:c4:96:80:
        13:a9:0d:da:95:e1:d9:52:63:b9:45:a7:46:b3:6c:08:b3:be:
        8f:d2:f9:e2:86:02:20:7f:b0:53:5f:3f:3f:3e:e1:73:1b:49:
        bc:12:84:be:72:01:0b:42:0c:0e:9e:37:6d:18:49:14:1e:cf:
        76:ff:b5:dd:7e:ad:1a:af:bf:43:27:8e:9c:24:d3:2d:b5:34:
        ab:c9:ec:9c:98:a3:70:77:70:d5:09:04:07:ca:49:5d:f7:43:
        c7:36:c7:68:ed:aa:30:0e:06:5d:03:29:be:4f:89:db:43:30:
        db:aa:2e:64:4b:8b:a7:63:1c:fd:03:42:ab:28:d3:35:cd:6a:
        b6:e6:17:cd:f4:08:ba:4e:e2:e8:2e:51:ef:14:8d:41:83:c9:
        89:94:2f:f7:fb:b5:85:de:41:da:c3:93:d7:59:f8:22:27:dc:
        71:9c:b2:3a:84:ea:01:61:95:ee:5f:02:47:55:af:47:79:47:
        1a:5d:cc:cd:cc:63:7b:aa:f1:bd:84:f7:d1:71:ad:90:35:c7:
        98:aa:f3:a6:65:64:01:46:88:34:4b:f8:c4:4b:af:87:ab:01:
        13:24:52:d1:2d:d3:61:07:9c:b1:47:e6:1e:d3:47:11:55:64:
        d2:2f:f7:d2:fa:1c:ed:b8:82:c2:4f:3b:7e:26:79:c8:39:17:
        93:f4:26:43:54:6e:c2:52:9a:46:66:13:b3:c0:fb:df:7e:e9:
        2e:c9:38:a6:5a:55:a5:8d:4c:87:38:0e:8b:d9:49:4d:96:7c:
        da:d7:f0:92:7e:99:09:16:8f:63:ee:7d:2a:66:23:9c:22:11:
        5a:16:6b:d2:4f:8b:d6:aa:af:e4:02:da:b4:93:77:02:88:50:
        a0:ac:32:8f:02:d4:9d:26:ef:e1:a8:1e:6d:7a:17:52:da:17:
        18:6e:bb:e0:5c:c8:9d:7a:88:18:3a:80:33:95:5f:af:fa:9e:
        01:1c:7b:60:6c:74:29:ba:c2:be:eb:f7:fd:d7:34:f2:b1:4c:
        fe:57:06:5d:b2:7f:51:0c:93:5a:c7:f0:d3:66:de:8d:ea:ca:
        80:05:33:61:bd:64:80:4d:e8:64:81:73:cf:b1:1d:29:69:78:
        23:41:0b:bf:ae:6a:5a:1a:3c:dd:fb:73:ce:a8:0c:0b:93:9a:
        e1:8d:29:a5:a6:a1:f0:bf:b9:93:9c:15:be:ea:06:94:f8:80:
        06:dd:c7:58:af:fb:0c:63:84:bc:c3:42:6b:85:b2:ed:cf:91:
        9f:f1:4e:56:8b:b8:65:ab:a1:9d:dc:94:f5:23:8f:42:75:36:
        dd:83:0d:44:20:b3:0d:ab:0d:fc:6b:40:f0:a9:29:a0:aa:73:
        b5:c2:26:e6:a9:fd:cf:0a:ef:7a:be:f5:e3:ad:29:72:a7:a1:
        75:8b:42:6c:e0:fd:bf:ed:3b:a6:69:b2:76:e2:a2:f7:37:d5:
        e2:29:00:2a:44:a1:ac:0b:fb:44:4a:33:2d:5e:32:cb:d7:65:
        46:d4:62:91:05:6e:e5:4b:45:65:72:e6:50:7b:c3:d2:e5:26:
        ac:35:56:be:51:5b:bd:83:da:cf:65:2b:f0:84:99:a6:d7:76:
        81:af:50:f2:44:81:ae:f4:e1:6e:58:a5:c4:a5:bd:a2:af:48:
        69:07:50:33:b3:5a:0e:57:6d:7d:4c:41:34:7d:76:6a:c0:c9:
        36:44:75:4c:46:77:a4:99:51:1d:f8:73:e5:64:c0:65:23:86:
        b9:c8:ab:28:52:58:cc:01:c3:83:18:36:54:1f:b2:b1:de:81:
        29:26:c9:14:08:f8:9e:62:88:74:5c:f4:ff:b4:6c:77:05:7f:
        04:55:e8:b2:f7:16:f8:d0:bf:9a:b3:00:25:53:ad:d4:37:39:
        3e:05:4b:a7:35:11:e5:d0:55:46:87:d2:a4:d7:66:45:f0:6f:
        2e:a7:b1:2a:61:aa:c5:a7:43:e8:cc:79:d3:4e:5a:34:30:c1:
        10:3f:76:62:f5:24:99:39:24:79:00:ed:a6:15:df:02:b9:0d:
        8e:0f:c4:45:83:41:39:96:fe:3b:a2:bc:07:6b:5e:d5:0a:b8:
        f7:9c:d4:b3:26:a0:d3:88:55:95:da:cf:6e:ba:40:be:9d:b6:
        82:0d:56:82:d0:54:d1:2a:9c:78:40:e2:db:95:ca:0c:ef:f0:
        32:99:06:e4:b4:e8:32:72:b3:90:34:e3:39:4a:75:54:36:38:
        b1:c8:c8:cc:5d:2d:8a:97:28:9b:3e:9b:a2:91:42:48:cc:68:
        78:3d:e5:75:60:f9:38:34:60:91:93:be:61:de:34:6f:d4:93:
        e8:6b:4a:7b:2b:81:95:4f:98:6d:f1:0a:2e:77:7a:36:35:6d:
        bb:c0:15:66:2b:b9:9a:f4:a1:cc:d7:99:bf:89:59:85:3f:6d:
        33:b9:2f:01:f4:15:40:fb:35:65:51:ea:71:b1:fe:4a:1c:37:
        25:e1:81:c0:47:f9:44:86:da:26:9a:08:ca:c4:f3:79:f7:0b:
        99:25:09:64:1f:1b:71:b6:8b:12:07:71:4d:59:9f:44:61:3d:
        22:e0:69:00:9e:a1:e5:3f:29:4e:03:8f:0f:61:aa:05:5a:1d:
        50:f8:62:d8:d8:94:0d:12:66:0b:7c:e3:00:d1:e9:43:cd:3d:
        8d:bb:5a:31:50:b9:31:3e:0e:bb:91:ba:a0:79:ea:6a:5b:a6:
        58:99:9e:c9:1f:4e:67:84:04:05:d0:8d:c8:2d:2f:70:db:12:
        5b:4f:e5:73:61:f1:c7:ea:e3:6d:5c:c2:00:fd:29:2c:17:09:
        54:ca:32:8a:b8:2a:06:74:1f:93:84:8a:4e:39:d4:eb:7d:dc:
        e8:c0:79:95:c0:76:83:a3:d9:81:fc:35:92:61:f5:dc:2d:cb:
        4a:87:79:1a:cd:09:4f:aa:5f:a1:9e:13:23:a6:33:1b:04:e3:
        00:d1:9c:c8:ae:1d:8a:29:c8:40:fa:cb:8b:ee:be:1f:ea:d2:
        c5:d1:e6:bb:d2:e4:1b:bb:d0:68:6c:21:22:32:0b:b1:f2:79:
        5a:25:e7:1e:47:3a:65:5b:25:e5:6e:6d:a6:b5:ad:7a:a4:8a:
        d9:ae:6b:24:fa:59:f9:35:0e:dd:99:69:ed:10:93:15:61:3e:
        e9:35:8e:c3:ea:88:2d:c2:8c:92:fb:a1:5d:1a:b4:51:13:c3:
        3e:14:92:6d:f7:6f:80:79:d1:30:8d:9c:16:f6:6d:52:11:a6:
        23:4a:d0:9d:98:02:44:fc:9a:ae:3c:97:1c:33:eb:52:07:25:
        83:d1:f5:2a:3b:9a:e3:51:34:64:24:1e:fb:3f:10:1a:bc:61:
        f0:8b:7b:ef:53:c2:da:21:7f:5a:c8:26:d6:2d:84:21:88:40:
        e9:36:8f:97:31:89:1d:ad:7a:e9:61:9d:8a:3f:ed:40:01:ea:
        d3:e9:6f:9d:eb:3a:b7:59:4d:e1:2a:31:ac:14:d9:8f:43:a8:
        a5:28:78:2b:35:07:1c:2f:5c:af:d6:ab:7d:48:7b:e1:d5:e1:
        8c:7a:c2:3e:5f:00:3a:8e:1c:52:cd:80:15:b1:77:c6:67:0d:
        f4:af:f4:53:a6:cf:0e:db:bf:01:90:49:5d:a6:a5:8a:48:bd:
        90:fe:59:a2:0f:bb:19:f6:7f:b9:42:e6:14:c2:9c:16:bb:16:
        9f:f0:21:73:5f:b3:4a:96:d2:4e:32:4f:3e:51:65:c3:29:24:
        45:2c:db:7f:b5:8d:90:89:1b:91:39:51:de:80:5c:6e:3a:3e:
        1b:7d:87:f1:f6:17:09:c6:10:ff:dc:d5:da:1f:6a:9c:a5:d0:
        f5:84:8d:92:ae:f6:b2:b1:84:bf:df:0a:7a:65:66:d7:e4:cc:
        16:6d:28:75:21:1e:38:ea:77:71:19:f7:e8:91:c3:98:07:87:
        4d:3a:b2:d9:4f:2b:1b:5e:1c:a6:d0:72:36:5e:de:7e:d8:5b:
        46:ca:db:f7:e9:c5:94:b8:f0:36:a5:73:d3:b1:9c:0a:f1:ce:
        f1:66:36:95:4b:06:36:8f:f5:2b:82:d1:d2:58:5b:40:59:f5:
        05:45:a9:e3:49:1b:1a:7c:65:20:28:c8:3a:a2:f1:5f:13:85:
        c8:e5:b8:5d:f8:40:59:00:9d:93:88:7e:8e:85:1a:b1:b5:16:
        d6:70:b0:6a:36:98:17:77:cd:c0:71:65:59:ee:98:a9:09:8c:
        20:a7:81:df:24:82:ce:70:1e:af:da:ba:b6:41:66:7e:aa:be:
        1d:d2:db:b5:60:9c:f7:06:ff:a7:ef:37:c4:37:1e:4b:12:77:
        4d:44:0d:13:bc:a0:07:29:35:5f:fe:2b:e2:5b:7a:c2:80:2e:
        6e:82:7e:fc:08:ad:5a:c2:87:b1:86:f1:5e:5d:d3:d7:75:61:
        58:ac:80:48:b5:8a:41:1b:a7:9a:ba:36:7f:f1:a4:fd:3d:55:
        78:55:aa:59:ec:d0:e2:c1:e3:01:eb:e8:32:dc:d7:af:3e:e3:
        69:51:f8:4f:43:9a:db:72:95:98:6e:6f:73:2b:7e:7f:65:f9:
        17:35:73:62:f5:63:1d:3e:1a:30:4c:8d:3b:96:43:2d:e3:d5:
        c3:cd:62:94:05:7d:95:5c:4e:19:77:72:ac:33:f2:fc:36:2d:
        bc:2b:51:c0:cc:d7:16:af:3f:d6:67:ca:2c:90:78:7c:7d:b2:
        3f:e4:53:95:e6:84:dd:57:a5:5c:fa:12:0d:7d:3f:0e:da:d7:
        b0:45:7f:e2:ad:14:33:3d:df:92:97:f4:f9:03:71:35:ed:29:
        42:d2:9c:85:c2:38:37:c9:01:02:76:83:16:ac:52:c7:d4:9a:
        0e:95:8e:10:0f:0c:4a:10:6e:06:e5:8b:3f:9b:39:b9:d2:aa:
        ca:b2:ae:48:86:9f:70:36:8b:ec:45:d1:a0:e9:eb:ec:84:9c:
        07:1d:b2:10:2e:4c:e7:90:b9:08:17:25:7a:b0:1f:c4:cd:2e:
        d2:0d:f3:2a:78:c6:6a:58:7c:26:a5:bc:3f:6d:c3:f7:1f:e3:
        26:6b:e2:06:28:8a:b9:e7:f3:68:9d:4b:6b:bd:16:9a:d3:b7:
        da:cd:d1:7b:6e:d2:fb:82:85:d9:6e:0c:98:f6:1d:7e:74:61:
        ab:f9:62:47:4f:98:2b:9c:9f:49:fb:53:6f:a5:d4:a2:8a:5c:
        bb:cb:6f:8b:19:b3:63:bf:8b:4c:11:15:94:22:bc:cd:d0:bd:
        6d:61:34:32:49:e0:5e:82:12:e2:59:f2:3b:4d:62:96:8c:ab:
        6d:6b:8a:bd:cd:3e:99:d4:24:bb:0a:43:eb:ad:d8:54:3f:85:
        6d:d6:27:3d:8b:35:1c:65:c4:5e:0e:d8:a8:46:90:c9:99:50:
        02:c6:06:fb:d1:73:bc:78:31:72:51:d8:0e:19:8e:34:41:42:
        99:09:e6:36:a4:db:d9:c3:a4:e9:4c:c4:7e:45:9b:d6:f3:5b:
        ff:10:22:ad:07:d2:19:b4:d5:62:5e:8f:d7:e1:4f:93:ff:e9:
        e0:ab:e9:85:23:eb:e3:c8:c4:14:0d:ad:ee:00:1b:b9:4f:e1:
        d6:55:dc:ee:57:9b:65:01:f6:f7:37:6c:bd:1d:ea:53:85:9e:
        54:ff:c2:eb:a1:dc:18:de:6a:25:5a:bf:7f:a8:9c:28:d6:b6:
        72:02:fb:ee:9c:69:36:c3:c1:d1:2c:d2:6a:e5:be:92:8e:10:
        f2:25:c2:a6:3b:4c:09:20:dd:ac:60:71:9d:9d:ea:58:0d:dc:
        06:ce:b6:a9:46:76:37:64:2d:7b:9d:d5:79:a5:8a:ea:d7:6e:
        79:e3:e9:51:61:d7:af:22:12:8a:a4:23:6e:d0:7f:ff:79:bd:
        1f:48:9c:f4:f8:86:00:b8:5d:da:91:3c:03:70:1e:42:fe:76:
        39:20:72:d0:cc:09:f5:58:1f:db:9e:19:5e:02:bd:2f:4a:c4:
        75:8c:76:1f:8f:42:d6:4a:b0:28:a4:22:ef:4e:e1:a3:26:15:
        7e:77:e2:e0:79:27:09:56:b0:b0:24:1e:a7:50:09:ed:6a:6f:
        64:84:fd:82:34:3f:72:39:0e:50:4b:57:dd:4d:cb:69:f6:33:
        e5:29:e2:6e:f4:e9:cc:52:32:f7:a3:f7:b9:80:06:8e:c4:cb:
        28:a6:f1:0d:47:a4:fc:6a:4e:32:49:44:cc:c5:93:eb:95:ed:
        3f:4f:e6:1e:a4:82:4a:8f:d9:9a:07:2f:06:48:fb:cf:76:ee:
        ec:d5:5f:ea:ee:77:c6:a0:cf:f9:ac:3b:ad:b0:eb:27:6a:06:
        a3:e5:eb:f9:1c:59:e3:56:71:a3:87:0c:f0:f7:af:fc:e0:4e:
        72:cb:2f:15:8e:c4:9f:e3:b3:6d:98:42:f1:54:2d:8a:dc:e7:
        6a:f7:30:1c:a6:cd:99:64:5f:b0:e8:46:c0:6e:3a:c5:7e:3a:
        fe:be:3f:ba:7e:ab:56:03:e5:52:b1:d4:f2:92:88:33:e5:e6:
        09:4e:9a:2e:cb:b3:4f:ff:04:ce:6d:09:0e:49:2f:ad:6d:2c:
        0e:a7:50:96:a3:50:3e:9c:5f:b1:8b:84:18:8a:f1:63:8d:7f:
        62:50:e5:bb:fc:5d:88:f6:62:40:18:5b:dc:7a:05:ee:a4:f2:
        e6:c5:90:23:ef:7b:f7:a1:34:c3:2b:7a:9b:5e:f3:83:cf:5c:
        00:a2:67:e5:7a:9a:2c:b6:24:a0:71:9b:a2:45:4f:ef:2a:c2:
        1c:c7:ab:d9:85:b2:cd:c4:af:cf:ae:65:da:6f:e3:74:30:69:
        ce:41:af:f4:ef:35:17:cb:f6:a7:f2:59:b9:9a:bb:40:8b:41:
        c4:a3:f3:16:bb:a4:4f:4d:ae:80:f3:4a:4a:63:7f:96:fe:e9:
        cd:9d:7e:bb:fe:9b:04:37:16:4e:e3:70:de:d3:fb:05:a4:96:
        d4:fa:d0:36:40:2f:41:36:0f:c6:c3:71:d1:33:93:17:b6:a3:
        5f:37:12:e6:0f:f6:65:62:dd:5f:c5:cb:a7:56:9a:10:fa:aa:
        32:6e:2e:4c:1d:2c:fc:6f:df:9c:c4:fd:94:08:b1:8d:86:63:
        8b:2c:75:36:44:58:5d:27:ce:3c:bf:7c:71:7d:24:c7:ee:9f:
        0f:a0:d6:55:d9:2a:95:3b:35:a7:52:c7:7f:5f:ed:82:54:85:
        2c:3e:f3:ce:56:ed:04:94:d1:8a:9b:0e:7a:8e:49:90:ff:a6:
        7d:ee:5a:82:44:9a:5a:39:b7:ee:53:0a:1c:d9:f2:18:33:6e:
        17:f5:7b:3a:eb:f4:99:9e:fb:ea:e0:61:de:54:b1:40:ab:f1:
        10:df:0a:1f:51:a0:12:28:57:fa:ac:6e:31:14:02:dd:6b:41:
        40:08:3e:59:22:de:2f:4a:38:78:5f:4e:23:ea:da:fa:d2:bd:
        1a:14:a1:a6:3d:50:47:72:9a:96:24:18:95:ef:6a:2c:15:e9:
        29:89:2e:a6:b7:00:4a:61:e1:8c:40:65:83:d4:09:fb:bd:93:
        1a:ea:26:cd:19:79:8e:e5:4f:12:9a:84:d4:2c:b8:e1:ee:dd:
        41:a5:c1:12:a7:2f:66:18:e9:0f:9c:4d:6d:6c:65:ec:46:1d:
        57:d8:07:09:f7:13:34:52:88:07:2c:3a:56:d0:dc:6b:46:1f:
        65:4c:21:50:a4:0e:d3:6d:2e:45:b1:3d:bb:d9:6d:44:a5:5d:
        c0:d4:05:86:f8:a4:b8:3c:3f:cd:b1:8b:0c:17:77:62:4f:5c:
        d7:8f:06:3c:fa:ac:26:a8:f7:1f:8d:83:ab:c9:9d:cc:c8:ff:
        60:b0:b9:b3:01:78:7a:83:c6:5d:45:36:d9:60:88:f5:88:b8:
        f2:2a:01:27:9e:c4:d2:bf:9f:e6:59:82:83:fe:7d:d8:5c:e5:
        32:a4:2c:57:70:40:9b:1b:dd:16:fc:6d:c4:66:57:a9:6a:31:
        0f:dd:27:fe:4c:90:dd:0e:1b:c3:af:96:ed:52:21:a9:dc:fa:
        4d:ba:8a:a8:da:9e:ce:8f:6e:6f:b3:d3:19:04:89:6e:cb:ac:
        60:ee:07:7b:3d:0c:3e:2f:76:b1:11:68:33:66:46:2e:81:a9:
        11:48:05:34:cf:e5:65:a8:43:77:06:b7:07:b5:0a:ba:a7:ee:
        56:78:14:2e:62:da:d8:b8:5d:00:d7:dd:b6:9b:b7:3e:8a:ba:
        a3:8f:df:59:6d:a7:72:55:67:c5:c3:5e:77:68:85:91:12:8f:
        1c:c8:cf:21:07:b1:44:d0:8b:a1:9a:58:9b:c2:6e:2e:a9:24:
        4a:fb:d1:70:89:8e:b3:86:85:fd:3f:2c:23:42:5f:76:df:a6:
        08:c9:5c:93:04:20:1a:ec:b9:5f:3a:63:ce:24:29:7e:4d:34:
        7e:dc:a0:e1:b2:ff:45:95:0d:9e:c2:ce:6d:99:ca:58:47:f2:
        1b:81:d1:d2:01:85:eb:a3:b8:c7:ec:05:ef:18:a7:8c:7c:cc:
        90:97:eb:4e:c0:e8:fa:df:d4:80:fa:cf:b7:8b:3d:d3:05:39:
        6f:74:82:08:78:ed:25:06:3d:5a:95:2e:b2:ad:32:35:2f:0c:
        1e:d5:3b:a1:02:d6:d0:b1:de:22:63:c1:6a:e3:99:a4:25:5b:
        cd:fd:f0:2b:f2:bf:50:3d:35:e9:ac:56:c7:50:9f:4f:97:94:
        ae:1d:ec:65:12:6c:dc:00:83:83:07:1a:25:6e:4c:c7:2e:7f:
        6c:43:54:16:76:7e:c5:f3:ad:65:3b:08:ba:15:24:4f:4d:3f:
        72:56:97:f8:a9:3b:26:0d:1d:0e:a7:96:9e:49:35:43:5a:5c:
        2e:36:bd:b1:57:48:24:de:4b:b2:31:21:a7:54:2d:c6:d0:f8:
        86:ba:39:04:aa:13:de:82:17:c8:ab:be:bb:e8:6f:f0:8d:1a:
        9c:de:04:0b:fe:08:74:27:ce:43:bf:53:52:7e:31:17:53:af:
        8f:5c:84:78:91:83:4f:8c:bb:2c:b8:0b:90:42:f7:22:3d:24:
        4b:8a:0e:f5:e0:be:7f:f5:f6:c7:f8:b2:76:8f:6d:a2:01:5d:
        bc:b2:ac:4b:d9:d3:05:14:db:ce:bf:b6:57:6b:ae:d6:8a:c5:
        8a:18:00:0f:bf:62:84:54:0b:18:9c:95:42:c8:59:f6:98:d2:
        da:47:25:89:e9:54:22:b0:45:86:c6:b6:c9:79:03:6c:b4:55:
        35:f3:60:15:c8:e8:85:0a:a4:39:c0:04:4d:44:a2:06:74:27:
        6a:24:61:eb:3a:bd:13:9b:a7:fc:88:5a:66:24:b1:9d:91:6a:
        8b:0e:c6:ea:dd:76:9d:4d:dd:6d:71:93:e0:d1:65:36:ca:f0:
        d2:df:ce:13:e0:ac:54:1f:c6:5a:e2:7f:a8:5e:5d:d4:c0:d8:
        39:07:e4:eb:75:cc:69:91:a0:b3:89:56:f4:5f:97:ab:86:72:
        48:11:c8:a9:a2:40:9b:c6:d2:7c:a3:47:b8:a9:26:da:94:2c:
        03:c4:80:b1:c0:2c:ab:29:8b:95:b2:c6:be:90:c7:b9:f5:67:
        c8:39:ae:20:65:63:06:92:c9:7e:f1:5f:ba:fd:15:b7:0f:85:
        c9:7a:b3:80:3c:7f:af:47:19:44:77:13:43:13:4e:34:ab:87:
        58:4a:e2:66:d3:55:d1:11:1d:6a:9f:99:3d:5e:aa:42:74:e6:
        47:84:2a:cf:ae:68:f7:bd:f6:ea:28:fe:ec:24:03:45:60:54:
        28:5d:f7:6c:b3:cd:1c:58:49:54:7e:c1:5c:68:d4:97:f3:51:
        83:4c:ad:44:13:f2:0f:a8:5f:33:9c:c8:fd:55:c9:7c:36:9d:
        d4:ca:77:52:dc:f2:15:f9:2e:fd:24:07:55:f6:49:cf:07:3f:
        eb:cb:ac:1f:89:19:70:17:cd:d6:d7:19:3f:ed:b4:c5:c1:fd:
        9d:26:66:f3:a7:4d:f6:01:cc:1d:66:de:e6:27:6d:16:59:eb:
        17:e0:b7:27:f5:42:be:b2:13:86:8c:cc:f1:3e:c8:51:61:10:
        65:10:8e:d4:29:52:f5:30:67:a4:14:9d:eb:79:4e:82:0a:da:
        07:2d:97:f6:d8:9e:26:d6:45:8a:43:de:52:81:c9:7f:1e:e4:
        65:b5:a3:a3:c0:c6:58:21:a0:5a:16:1a:79:2b:bd:0c:e5:b1:
        63:4d:05:94:ca:6b:a0:04:53:11:97:79:44:cb:ac:6f:5c:4c:
        c5:71:aa:8d:b3:f1:cd:38:ef:7a:32:57:d6:48:3c:28:ef:dc:
        f2:83:a5:fc:7e:66:27:20:b5:23:86:f1:f5:72:30:a9:7a:28:
        90:65:9d:52:28:cc:d7:78:6d:00:20:f6:20:57:12:0c:72:6c:
        59:3d:4b:29:d6:8d:0d:bb:8c:13:be:9d:05:06:53:ed:4a:9d:
        eb:4d:d3:38:ab:ff:0b:2a:aa:49:a8:8b:cf:16:7e:ec:55:71:
        7d:bf:7c:4d:63:a2:f0:24:36:5f:35:1d:ea:37:d0:8b:b3:c7:
        c0:0b:ae:91:8e:e6:b2:a6:63:32:17:08:45:12:be:85:30:96:
        4c:d5:dc:ea:b6:a0:3b:6f:d4:cb:b5:39:6a:a3:8f:c1:dd:c8:
        23:8d:c0:a5:90:3a:d4:f3:e3:77:c5:62:d9:3b:2f:0d:c0:98:
        90:40:48:90:bb:ff:bf:19:17:b4:b2:26:74:02:f1:b6:6e:de:
        4f:d3:65:02:15:d5:dd:90:82:9d:7c:d2:0b:09:e8:8b:84:fe:
        19:25:00:27:2f:ff:5a:c2:ec:81:57:89:83:d7:86:e0:61:6b:
        63:f7:f0:09:61:bd:cb:4b:1c:77:96:2b:ec:97:f1:b3:92:da:
        00:ba:96:78:04:d2:1d:5a:0a:6b:ef:26:67:f4:a7:b3:e8:9a:
        e5:77:7e:75:2e:71:0c:57:52:f1:54:30:47:23:38:55:80:94:
        d1:e0:67:d7:46:92:6f:20:90:5f:b9:9b:76:cd:b8:5f:9c:bf:
        e5:eb:84:9d:0d:d8:2b:17:61:00:7c:be:70:7a:80:01:e0:72:
        cc:0b:f7:70:dc:a3:78:82:f4:4e:28:9e:13:fc:c7:85:16:8f:
        21:3d:ce:ec:13:cd:ca:7d:b1:7c:ac:11:42:00:6a:fc:19:6e:
        ee:35:d3:51:17:ca:0b:6c:1c:a9:21:d2:48:41:30:4e:d1:23:
        b7:7f:15:b7:f1:5f:d9:93:d8:84:60:7b:78:db:6c:ab:c2:b4:
        d8:86:16:d0:6e:6a:9d:62:c1:f0:fa:1a:08:70:de:73:cd:b8:
        50:6a:e5:d2:f9:f8:06:94:68:c5:95:12:f4:52:50:19:b2:d7:
        6c:68:18:ca:de:ed:24:64:14:f8:c3:e5:7b:e9:ed:bc:e7:d0:
        f5:dc:fa:bd:fc:05:7e:c5:c4:6e:c1:cc:29:10:22:81:5f:2b:
        2e:f7:25:5e:a8:57:44:c3:26:e6:8f:cf:0c:ba:d5:b6:24:01:
        6c:28:d9:70:72:11:7d:a3:69:f2:0f:73:fa:2a:3e:34:b6:6a:
        0a:ab:a5:45:78:b8:27:16:a8:d0:fa:6f:4d:22:66:9c:23:0c:
        3c:23:57:c9:4d:46:de:f1:4f:b3:1a:1f:7e:c1:65:70:a1:b8:
        8e:e9:31:eb:77:07:ef:48:17:4d:53:aa:65:b3:dd:b0:9b:09:
        0c:87:f2:08:ce:f5:46:1f:16:2d:51:06:1a:20:31:39:5d:93:
        9c:c7:17:1a:28:50:64:6b:74:89:96:a4:d7:07:32:35:64:69:
        86:91:b3:f5:09:87:bf:eb:fb:09:1d:90:ca:dc:2a:3d:7f:ca:
        d7:eb:05:19:c9:d6:e2:ee:fc:ff:00:00:00:00:00:00:00:00:
        00:00:00:00:00:00:00:00:00:00:00:03:0c:17:20:25:2a:30:
        38:30:82:03:4e:a0:03:02:01:02:02:11:00:81:7d:90:3d:bc:
        f3:44:54:9c:ba:d1:19:db:8c:39:f0:30:0c:06:0a:2b:06:01:
        04:01:86:8d:1f:01:64:30:19:31:17:30:15:06:03:55:04:03:
        0c:0e:4d:79:50:72:6f:64:75:63:74:69:6f:6e:43:41:30:1e:
        17:0d:32:35:30:35:30:31:32:30:32:36:31:31:5a:17:0d:32:
        36:30:35:30:31:32:30:32:36:31:31:5a:30:19:31:17:30:15:
        06:03:55:04:03:0c:0e:64:65:6d:6f:2d:63:6c:69:65:6e:74:
        2d:30:31:30:82:02:ce:30:0c:06:0a:2b:06:01:04:01:86:8d:
        1f:01:00:03:82:02:bc:00:73:d3:fd:5b:9c:a4:b1:d4:14:8f:
        1a:f0:38:fd:d7:f2:2f:d3:8d:95:ad:88:8e:e1:f8:9a:f7:23:
        ad:9f:59:16:92:5f:7e:21:e7:71:d1:bb:39:4d:5b:10:09:33:
        f5:60:16:c1:15:30:02:5b:b4:2a:e9:89:19:25:6d:f3:9d:ab:
        c2:4b:93:32:3f:be:53:d6:73:c4:a8:d8:11:2c:f2:55:e3:f4:
        a5:e1:26:cd:a8:dd:84:07:8c:69:51:0a:6f:77:99:09:d4:79:
        7a:90:b1:56:17:64:c9:2e:ee:0c:5f:66:04:33:72:43:42:e8:
        64:82:f1:87:a9:c2:97:b4:54:6b:70:08:46:58:75:00:1d:5a:
        53:82:be:a8:39:29:f5:51:46:d9:23:37:74:d5:a5:68:02:75:
        f5:4b:78:86:72:5c:de:11:75:7c:f9:d0:19:a9:e2:8c:4a:22:
        a3:e9:a1:bb:80:23:6c:cc:4b:55:e2:10:03:f7:2c:0a:af:1b:
        10:b9:90:d1:f3:a6:e7:82:74:66:3e:eb:d4:be:35:07:4c:d3:
        07:0c:45:ab:4d:f2:1c:bf:6b:ec:ea:75:00:8c:19:b7:36:97:
        00:56:d8:fa:15:2e:8e:27:7a:f2:f6:07:75:f5:a6:3d:38:cb:
        d7:50:22:e3:1e:6f:de:a1:e8:42:8d:6b:f8:7f:99:a1:74:a9:
        c6:a7:8f:d8:de:84:a3:a4:df:e4:15:b6:19:bc:23:3e:bc:89:
        d8:8c:58:da:e7:8f:e3:44:e7:7d:55:10:7f:a2:77:8b:27:35:
        ac:13:6a:cc:eb:68:c3:2e:82:f5:ea:9b:e3:27:3b:6f:70:83:
        55:a3:9b:98:32:0d:1a:83:80:b7:f8:96:74:c4:e8:ad:98:64:
        8e:86:87:77:99:61:e0:13:e4:4c:39:83:5e:8a:a8:7a:54:8b:
        e2:99:3f:25:8a:20:0e:4a:cc:cc:51:f0:7c:d7:ea:4a:af:d4:
        26:2c:e0:b5:2c:fc:74:21:fe:91:b2:1c:44:00:02:07:61:0b:
        7e:58:71:20:bc:79:59:98:ec:d2:09:1f:40:88:36:98:40:c4:
        69:21:e6:e1:1f:86:84:64:fa:cf:e3:1f:f8:70:c7:de:54:34:
        1e:be:68:27:62:c7:63:4d:3f:52:da:a5:57:24:22:eb:09:0e:
        8b:b1:b7:b1:33:40:1e:66:c8:fb:70:db:39:b4:cf:0e:51:91:
        52:71:e1:03:70:9d:42:02:c0:8f:94:0d:24:8f:e8:6f:20:a1:
        3b:60:f5:a8:81:36:81:b0:c7:52:35:7b:7b:4c:65:30:a1:a4:
        41:d6:de:5b:bd:d9:09:e1:6e:bc:b4:ac:72:b8:cf:1d:79:d1:
        3a:0d:00:a1:81:a8:01:8b:b3:b3:84:19:10:ab:a3:e2:b7:18:
        73:cb:54:cc:72:a7:1c:fe:16:c5:e2:c9:e8:44:fa:29:be:4c:
        37:79:0b:c0:92:98:a9:91:0f:e3:94:c4:b5:8c:2b:de:c2:9c:
        cd:37:83:8c:9f:1d:44:da:07:d7:72:03:b2:6e:4c:a7:81:2f:
        5e:fc:e8:a1:81:95:65:f7:95:38:07:ae:d0:97:d6:8e:1a:d3:
        32:b2:2b:14:c5:95:ea:fb:39:ab:86:f2:0d:b4:d3:fa:f5:31:
        de:fd:8f:d8:86:d3:c6:cf:dd:8c:0f:0a:f4:22:aa:4b:47:97:
        c4:34:08:a5:c9:83:f9:87:13:ba:d3:52:82:43:0c:9f:d2:27:
        6e:c3:5b:d0:fb:18:01:6e:50:50:ef:eb:19:af:69:05:17:a1:
        ce:78:6b:07:87:c3:bf:f1:5f:68:f5:13:dd:9a:86:f1:f6:4a:
        62:63:4a:36:0c

æ—¥æœ¬èªè§£èª¬
X.509 ã®æ‹¡å¼µéƒ¨ï¼ˆextensionsï¼‰ãŒç©º
ã‚ãªãŸãŒä½œã£ãŸè¨¼æ˜æ›¸ã«ã¯æ‹¡å¼µéƒ¨ã‚’è¿½åŠ ã—ã¦ã„ãªã„ã®ã§ã€extensions ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è‡ªä½“ãŒå­˜åœ¨ã›ãšã€ç©ºã§è¿”ã£ã¦ãã¾ã™ã€‚ã‚ˆã£ã¦å¾“æ¥ã®ã€Œextensions ã‚’æ¢ã™ã€ã‚³ãƒ¼ãƒ‰ã¯ãã‚‚ãã‚‚å½“ã¦ã¯ã¾ã‚Šã¾ã›ã‚“ã€‚

Dilithium å…¬é–‹éµã¯ SPKI ã«å…¥ã£ã¦ã„ã‚‹
ã€ŒSubject Public Key Infoã€ã¯è¨¼æ˜æ›¸ã®å¿…é ˆè¦ç´ ã§ã€ã“ã“ã«å…¬é–‹éµæœ¬ä½“ãŒ BIT STRING ã¨ã—ã¦æ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã® OIDï¼ˆ1.3.6.1.4.1.99999.1.0ï¼‰ã¨ã€ç”Ÿã®å…¬é–‹éµãƒã‚¤ãƒˆåˆ—ãŒã“ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚

.asOctets() ã§ãƒ“ãƒƒãƒˆæ–‡å­—åˆ—ã‹ã‚‰ãƒã‚¤ãƒˆåˆ—ã‚’å–ã‚Šå‡ºã™
pyasn1 ã® BitString ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ .asOctets() ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šï¼ˆå…ˆé ­ã®ã€Œunused bitsã€ãƒã‚¤ãƒˆã‚’å†…åŒ…ã›ãšã«ï¼‰ãƒã‚¤ãƒˆé…åˆ—ã‚’å–ã‚Šå‡ºã›ã¾ã™ã€‚ãã‚Œã‚’ .hex() ã§è¡¨ç¤ºã™ã‚Œã°ã€Dilithium å…¬é–‹éµã®16é€²è¡¨ç¾ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

ã“ã‚Œã§ã€Œæ‹¡å¼µãŒãªã„ã€å•é¡Œã¯è§£æ±ºã—ã€SPKI ã‹ã‚‰ã¡ã‚ƒã‚“ã¨ Dilithium å…¬é–‹éµã‚’å–ã‚Šå‡ºã›ã‚‹ã¯ãšã§ã™ã€‚

(.venv312) D:\city_chain_project\CA>python test_pyasn1.py
ğŸ”‘ å…¬é–‹éµã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  OID = 1.3.6.1.4.1.99999.1.0
=== Dilithium å…¬é–‹éµï¼ˆhexï¼‰===
73d3fd5b9ca4b1d4148f1af038fdd7f22fd38d95ad888ee1f89af723ad9f5916925f7e21e771d1bb394d5b100933f56016c11530025bb42ae98919256df39dabc24b93323fbe53d673c4a8d8112cf255e3f4a5e126cda8dd84078c69510a6f779909d4797a90b1561764c92eee0c5f660433724342e86482f187a9c297b4546b7008465875001d5a5382bea83929f55146d9233774d5a5680275f54b7886725cde11757cf9d019a9e28c4a22a3e9a1bb80236ccc4b55e21003f72c0aaf1b10b990d1f3a6e78274663eebd4be35074cd3070c45ab4df21cbf6becea75008c19b736970056d8fa152e8e277af2f60775f5a63d38cbd75022e31e6fdea1e8428d6bf87f99a174a9c6a78fd8de84a3a4dfe415b619bc233ebc89d88c58dae78fe344e77d55107fa2778b2735ac136acceb68c32e82f5ea9be3273b6f708355a39b98320d1a8380b7f89674c4e8ad98648e8687779961e013e44c39835e8aa87a548be2993f258a200e4acccc51f07cd7ea4aafd4262ce0b52cfc7421fe91b21c44000207610b7e587120bc795998ecd2091f4088369840c46921e6e11f868464facfe31ff870c7de54341ebe682762c7634d3f52daa5572422eb090e8bb1b7b133401e66c8fb70db39b4cf0e51915271e103709d4202c08f940d248fe86f20a13b60f5a8813681b0c752357b7b4c6530a1a441d6de5bbdd909e16ebcb4ac72b8cf1d79d13a0d00a181a8018bb3b3841910aba3e2b71873cb54cc72a71cfe16c5e2c9e844fa29be4c37790bc09298a9910fe394c4b58c2bdec29ccd37838c9f1d44da07d77203b26e4ca7812f5efce8a1819565f7953807aed097d68e1ad332b22b14c595eafb39ab86f20db4d3faf531defd8fd886d3c6cfdd8c0f0af422aa4b4797c43408a5c983f98713bad35282430c9fd2276ec35bd0fb18016e5050efeb19af690517a1ce786b0787c3bff15f68f513dd9a86f1f64a62634a360c

âŒ Dilithium æ‹¡å¼µãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚